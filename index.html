<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>

        <!-- PWA Support -->
        <link rel="manifest" href="manifest.json">

        <!-- Boostrap CDN-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- bootstrap Icons CDN -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-dark">
    <div class="d-flex min-vh-100 justify-content-center align-items-center">

        <!-- Click to Weather Form -->
        <form class="card col-12 col-md-6 col-lg-4" id="frmEnter">
            <div class="card-body">
                <div class="d-flex justify-content-center">
                    <img src="images/weather.png" alt="Abstract People Image" style="max-width: 20%;">
                </div>
                <h1 class="text-center mb-2">Daily Forecast</h1>
                <p class="text-center">Click to get today's forcast!</p>
                <button class="btn btn-primary col-12 mt-3" type="button" id="btnGetWeather">Get Weather</button>
            </div>
        </form>

        <!-- Display Weather Form -->
        <div class="card col-12 col-md-6 col-lg-4" id="divDisplay" style="display:none;">

            <div class="card-body d-flex flex-column justify-content-between">

                <div class="d-flex flex-column align-items-center justify-content-center flex-shrink-0">
                    <i class="bi bi-geo-alt fs-1 mb-0 text-danger"></i>
                    <h1 class="mb-0 text-danger">Cookeville</h1>
                </div>

                <div id="divWeatherInfo" class="d-flex flex-column align-items-start w-100 mt-5">

                    <div id="divTemp"></div>

                    <div id="divHumidity"></div>

                    <div id="divRain"></div>

                </div>

                <button class="btn btn-link col-12 mt-1" type="button" id="btnBack">Go Back</button>
                
            </div>
        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        // Button to get weather
        $('#btnGetWeather').on('click', function(){
             $('#frmEnter').slideUp(function(){
                 $('#divDisplay').slideDown()
                 getWeather()
             })
        })

        // Button to go back
        $('#btnBack').on('click', function(){
            $('#divDisplay').slideUp(function(){
                $('#frmEnter').slideDown()
            })
        })

        // Function to get weather
        async function getWeather() {
            
            // Get the divs to display the weather info
            const tempInfo = document.getElementById('divTemp')
            const humidityInfo = document.getElementById('divHumidity')
            const rainInfo = document.getElementById('divRain')

            // API URL
            const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=36.1628&longitude=-85.5016&current=temperature_2m,cloud_cover,relative_humidity_2m,is_day,precipitation,rain,showers,snowfall,cloud_cover&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,precipitation&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,weathercode&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto&forecast_days=7`

            // Fetch the data
            try {

                // Fetching weather data from API
                const objResponse = await fetch(apiUrl)

                // Checking for errors
                if (!objResponse.ok){
                    throw new Error(`HTTP Error: ${objResponse.status}`)
                } 

                // Parsing the JSON data
                const objData = await objResponse.json()

                // Checking if current weather data is available
                if (objData.current){

                // Extracting weather data
                const temperature = objData.current.temperature_2m
                const humidity = objData.current.relative_humidity_2m
                const rain = objData.current.precipitation
                
                // Creating icons based on temperature, humidity, and rain
                let tempIcon
                if (temperature >= 75) {
                    tempIcon = `<i class="bi bi-thermometer-high fs-2 text-danger me-2"></i>`
                } else if (temperature >= 50) {
                    tempIcon = `<i class="bi bi-thermometer-half fs-2 text-warning me-2"></i>`
                } else {
                    tempIcon = `<i class="bi bi-thermometer-low fs-2 text-primary me-2"></i>`
                }

                let humidityIcon
                if (humidity >= 75) {
                    humidityIcon = `<i class="bi bi-droplet-fill fs-2 text-primary me-2"></i>`
                } else if (humidity >= 50) {
                    humidityIcon = `<i class="bi bi-droplet-half fs-2 text-primary me-2"></i>`
                } else {
                    humidityIcon = `<i class="bi bi-droplet fs-2 text-primary me-2"></i>`
                }

                let rainIcon
                if (rain >= 0.5) {
                    rainIcon = `<i class="bi bi-cloud-rain-heavy-fill fs-2 text-primary me-2"></i>`
                } else if (rain >= 0.25) {
                    rainIcon = `<i class="bi bi-cloud-rain-fill fs-2 text-primary me-2"></i>`
                } else if (rain > 0) {
                    rainIcon = `<i class="bi bi-cloud-rain fs-2 text-primary me-2"></i>`
                } else if (rain == 0) {
                    rainIcon = `<i class="bi bi-cloud fs-2 text-primary me-2"></i>`
                }


                // Displaying weather info
                tempInfo.innerHTML = `
                    <p class="fs-2">${tempIcon}<strong>${temperature}Â°F</strong></p>
                `
                humidityInfo.innerHTML = `
                    <p class="fs-2">${humidityIcon}<strong>${humidity}%</strong></p>
                `
                rainInfo.innerHTML = `
                    <p class="fs-2">${rainIcon}<strong>Rain:</strong> ${rain} mm</p>
                `
                }
                
            // Catch any errors
            } catch (error) {
                console.error('Error fetching weather data:', error)
            }
        }

    </script>

</body>
</html>